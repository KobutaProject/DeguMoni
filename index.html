<!-- 
  „Éá„Ç∞„ÉºÁí∞Â¢É„É¢„Éã„Çø„É™„É≥„Ç∞„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ + Áä∂ÊÖãÂà§ÂÆöÊ©üËÉΩÔºàÂ∑ÆÂàÜË°®Á§∫ÁâàÔºâ
  ‰ΩúÊàêÊó•: 2025-01-17
  Ë™¨Êòé: Ambient API„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„Ç∞„É©„ÉïË°®Á§∫ + 5ÂàÜÈñì„ÅÆÂ¢óÂä†Èáè„ÇíÊï∞ÂÄ§Ë°®Á§∫
-->
<!DOCTYPE html>
<html lang="ja">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>„Éá„Ç∞„ÉºÁí∞Â¢É„É¢„Éã„Çø„É™„É≥„Ç∞„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
        <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
        <div id="root"></div>

        <script type="text/babel">
                const { useState, useEffect, useRef } = React;

                function DeguMonitoringDashboard() {
                        const [data, setData] = useState([]);
                        const [latestData, setLatestData] = useState(null);
                        const [loading, setLoading] = useState(true);
                        const [lastUpdate, setLastUpdate] = useState(null);
                        const [dataRange, setDataRange] = useState(100);
                        const [error, setError] = useState(null);
                        const [updateKey, setUpdateKey] = useState(0);

                        // ÂÅ•Â∫∑Ë®òÈå≤Èñ¢ÈÄ£„ÅÆstate
                        const [healthRecords, setHealthRecords] = useState([]);
                        const [recordDate, setRecordDate] = useState(new Date().toISOString().split('T')[0]);
                        const [weight, setWeight] = useState('');
                        const [fecesCondition, setFecesCondition] = useState('');
                        const [memo, setMemo] = useState('');

                        const CHANNEL_ID = '77767';
                        const READ_KEY = '73ff0a03269c1f35';
                        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbygafxILyUYiajSYjThZeIezQS5SLzodxgjkfnmRFcqBEUo_iRS4MCeSUmlHsvl8XinVw/exec';

                        // „Éá„Ç∞„Éº„ÅÆÁä∂ÊÖã„ÇíÂà§ÂÆö„Åô„ÇãÈñ¢Êï∞Ôºà5ÂàÜÈñì„ÅÆÂ∑ÆÂàÜ„ÅßÂà§ÂÆöÔºâ
                        const judgeDeguState = (currentData, previousData) => {
                                if (!previousData) {
                                        return {
                                                states: [{
                                                        label: '‚è≥ „Éá„Éº„ÇøÂèéÈõÜ‰∏≠',
                                                        color: 'bg-gray-300 text-gray-700',
                                                        value: 'ÔºàÂâçÂõû„Éá„Éº„ÇøÂæÖ„Å°Ôºâ'
                                                }],
                                                diffs: null
                                        };
                                }

                                const states = [];

                                // 5ÂàÜÈñì„ÅÆÂêÑ„Çª„É≥„Çµ„Éº„ÅÆÂ∑ÆÂàÜ„ÇíË®àÁÆó
                                const rotDiff = (currentData.d1 || 0) - (previousData.d1 || 0);
                                const sitDiff = (currentData.d8 || 0) - (previousData.d8 || 0);
                                const drkDiff = (currentData.d6 || 0) - (previousData.d6 || 0);
                                const motDiff = (currentData.d7 || 0) - (previousData.d7 || 0);

                                // Â∑ÆÂàÜ„Éá„Éº„Çø„Çí‰øùÂ≠ò
                                const diffs = {
                                        rot: rotDiff,
                                        sit: sitDiff,
                                        drk: drkDiff,
                                        mot: motDiff
                                };

                                // 5ÂàÜÈñì„ÅÆËµ∞Ë°åË∑ùÈõ¢Â¢óÂä† (ROT-ACUM d1„ÅÆÂ∑ÆÂàÜ)
                                if (rotDiff > 0) {
                                        states.push({
                                                label: 'üèÉ Ëµ∞Ë°å‰∏≠',
                                                color: 'bg-purple-500 text-white',
                                                value: `+${rotDiff.toFixed(1)}m/5ÂàÜ`
                                        });
                                }

                                // 5ÂàÜÈñì„ÅÆËçâÁöøÈáçÈáèÂ§âÂåñ (KUSA-ACUM d8„ÅÆÂ∑ÆÂàÜ)
                                if (sitDiff > 0) {
                                        states.push({
                                                label: 'üçΩÔ∏è È£ü‰∫ã‰∏≠',
                                                color: 'bg-orange-500 text-white',
                                                value: `+${sitDiff.toFixed(1)}/5ÂàÜ`
                                        });
                                }

                                // 5ÂàÜÈñì„ÅÆÈ£≤Ê∞¥ÈáèÂ¢óÂä† (DRK-ACUM d6„ÅÆÂ∑ÆÂàÜ)
                                if (drkDiff > 0) {
                                        states.push({
                                                label: 'üíß È£≤Ê∞¥‰∏≠',
                                                color: 'bg-cyan-500 text-white',
                                                value: `+${drkDiff.toFixed(1)}ml/5ÂàÜ`
                                        });
                                }

                                // 5ÂàÜÈñì„ÅÆÂãï‰ΩìÊ§úÁü•Â¢óÂä† (MOT-ACUM d7„ÅÆÂ∑ÆÂàÜ) - Ëµ∞„Å£„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åø
                                if (motDiff > 0 && rotDiff === 0) {
                                        states.push({
                                                label: 'üêπ Ê¥ªÂãï‰∏≠',
                                                color: 'bg-green-500 text-white',
                                                value: `+${motDiff}/5ÂàÜ`
                                        });
                                }

                                // ÂØù„Å¶„ÅÑ„ÇãÂà§ÂÆö - ‰Ωï„ÇÇÊ¥ªÂãï„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Åø
                                if (states.length === 0) {
                                        states.push({
                                                label: 'üò¥ ‰ºëÊÅØ‰∏≠',
                                                color: 'bg-gray-500 text-white',
                                                value: 'ÔºàÊ¥ªÂãï„Å™„ÅóÔºâ'
                                        });
                                }

                                return { states, diffs };
                        };

                        const fetchData = async () => {
                                try {
                                        setError(null);

                                        const timestamp = Date.now();
                                        const random = Math.random().toString(36).substring(7);
                                        const apiUrl = `https://ambidata.io/api/v2/channels/${CHANNEL_ID}/data?readKey=${READ_KEY}&n=${dataRange}&_t=${timestamp}&_r=${random}`;

                                        console.log('üîÑ „Éá„Éº„ÇøÂèñÂæóÈñãÂßã:', new Date().toLocaleTimeString());

                                        const response = await fetch(apiUrl, {
                                                method: 'GET',
                                                mode: 'cors',
                                                cache: 'no-store',
                                                headers: {
                                                        'Accept': 'application/json'
                                                }
                                        });

                                        if (!response.ok) {
                                                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                        }

                                        const result = await response.json();

                                        if (result && result.length > 0) {
                                                const sortedData = result.reverse();

                                                const formattedData = sortedData.map(item => ({
                                                        ...item,
                                                        time: new Date(item.created).toLocaleString('ja-JP', {
                                                                month: '2-digit',
                                                                day: '2-digit',
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                        }),
                                                        timeOnly: new Date(item.created).toLocaleString('ja-JP', {
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                        }),
                                                        fullTime: new Date(item.created).toLocaleString('ja-JP')
                                                }));

                                                setData([...formattedData]);
                                                setLatestData({ ...formattedData[formattedData.length - 1] });
                                                setLastUpdate(new Date());
                                                setUpdateKey(prev => prev + 1);
                                                console.log('‚úÖ „Éá„Éº„ÇøÂèñÂæóÂÆå‰∫Ü:', formattedData.length, '‰ª∂');
                                                console.log('üìä ÊúÄÊñ∞:', formattedData[formattedData.length - 1].fullTime);
                                        }
                                        setLoading(false);
                                } catch (error) {
                                        console.error('‚ùå „Ç®„É©„Éº:', error.message);
                                        setError(error.message);
                                        setLoading(false);
                                }
                        };

                        // ÂÅ•Â∫∑Ë®òÈå≤„ÇíÂèñÂæó
                        const fetchHealthRecords = async () => {
                                try {
                                        const response = await fetch(GOOGLE_SCRIPT_URL);
                                        const records = await response.json();
                                        setHealthRecords(records);
                                        console.log('‚úÖ ÂÅ•Â∫∑Ë®òÈå≤ÂèñÂæó:', records.length, '‰ª∂');
                                } catch (error) {
                                        console.error('‚ùå ÂÅ•Â∫∑Ë®òÈå≤ÂèñÂæó„Ç®„É©„Éº:', error);
                                }
                        };

                        // ÂÅ•Â∫∑Ë®òÈå≤„Çí‰øùÂ≠ò
                        const saveHealthRecord = async () => {
                                if (!weight) {
                                        alert('‰ΩìÈáç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                                        return;
                                }

                                try {
                                        const response = await fetch(GOOGLE_SCRIPT_URL, {
                                                method: 'POST',
                                                mode: 'no-cors',
                                                headers: {
                                                        'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                        date: recordDate,
                                                        weight: parseFloat(weight),
                                                        fecesCondition: fecesCondition,
                                                        memo: memo
                                                })
                                        });

                                        alert('‚úÖ Ë®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
                                        setWeight('');
                                        setFecesCondition('');
                                        setMemo('');

                                        // ÂÜçË™≠„ÅøËæº„Åø
                                        setTimeout(() => fetchHealthRecords(), 1000);
                                } catch (error) {
                                        console.error('‚ùå ‰øùÂ≠ò„Ç®„É©„Éº:', error);
                                        alert('‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºàno-cors„É¢„Éº„Éâ„ÅÆ„Åü„ÇÅÁ¢∫Ë™ç‰∏çÂèØÔºâ');
                                        setTimeout(() => fetchHealthRecords(), 1000);
                                }
                        };

                        useEffect(() => {
                                fetchData();
                                fetchHealthRecords();
                                console.log('‚è∞ Ëá™ÂãïÊõ¥Êñ∞: 3ÂàÜÊØé');
                                const interval = setInterval(() => {
                                        console.log('üîÑ Ëá™ÂãïÊõ¥Êñ∞ÂÆüË°å');
                                        fetchData();
                                        fetchHealthRecords();
                                }, 3 * 60 * 1000);

                                return () => clearInterval(interval);
                        }, [dataRange]);

                        if (loading) {
                                return (
                                        <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                                                <div className="text-center">
                                                        <div className="text-2xl font-bold text-indigo-600 mb-4">„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠...</div>
                                                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                                                </div>
                                        </div>
                                );
                        }

                        if (error) {
                                return (
                                        <div className="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                                                <div className="bg-white rounded-lg shadow-lg p-8 max-w-md">
                                                        <div className="text-red-600 text-xl font-bold mb-4">‚ö†Ô∏è „Ç®„É©„Éº</div>
                                                        <div className="text-gray-700 mb-4">{error}</div>
                                                        <div className="text-sm text-gray-500 mb-4">
                                                                „Éñ„É©„Ç¶„Ç∂„ÅåAmbient API„Å∏„ÅÆÁõ¥Êé•„Ç¢„ÇØ„Çª„Çπ„Çí„Éñ„É≠„ÉÉ„ÇØ„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
                                                        </div>
                                                        <button
                                                                onClick={() => {
                                                                        setLoading(true);
                                                                        setError(null);
                                                                        fetchData();
                                                                }}
                                                                className="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                                        >
                                                                ÂÜçË©¶Ë°å
                                                        </button>
                                                </div>
                                        </div>
                                );
                        }

                        // ÊúÄÊñ∞„Éá„Éº„Çø„Å®„Åù„ÅÆ1„Å§Ââç„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
                        const previousData = data.length >= 2 ? data[data.length - 2] : null;
                        const judgmentResult = latestData ? judgeDeguState(latestData, previousData) : { states: [], diffs: null };
                        const deguStates = judgmentResult.states;
                        const sensorDiffs = judgmentResult.diffs;

                        return (
                                <div key={updateKey} className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                                        <div className="max-w-7xl mx-auto">
                                                {/* „Éò„ÉÉ„ÉÄ„Éº */}
                                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                                                <div>
                                                                        <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                                                                üêπ „Éá„Ç∞„ÉºÁí∞Â¢É„É¢„Éã„Çø„É™„É≥„Ç∞
                                                                        </h1>
                                                                        <p className="text-gray-600">„ÉÅ„É£„É≥„Éç„É´: DeguMoni_Integrated (ID: {CHANNEL_ID})</p>
                                                                </div>
                                                                <div className="text-right">
                                                                        <div className="text-sm text-gray-500 mb-2">
                                                                                ÊúÄÁµÇÊõ¥Êñ∞: {lastUpdate?.toLocaleString('ja-JP')}
                                                                        </div>
                                                                        <div className="text-xs text-gray-400 mb-2">
                                                                                Ê¨°ÂõûÊõ¥Êñ∞: 3ÂàÜÂæåÔºàËá™ÂãïÔºâ
                                                                        </div>
                                                                        <div className="flex gap-2">
                                                                                <select
                                                                                        value={dataRange}
                                                                                        onChange={(e) => setDataRange(Number(e.target.value))}
                                                                                        className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                                                >
                                                                                        <option value={50}>50‰ª∂</option>
                                                                                        <option value={100}>100‰ª∂</option>
                                                                                        <option value={300}>300‰ª∂</option>
                                                                                        <option value={600}>600‰ª∂</option>
                                                                                </select>
                                                                                <button
                                                                                        onClick={() => {
                                                                                                console.log('üîò ÊâãÂãïÊõ¥Êñ∞');
                                                                                                fetchData();
                                                                                                fetchHealthRecords();
                                                                                        }}
                                                                                        className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                                                                                >
                                                                                        üîÑ ‰ªä„Åô„ÅêÊõ¥Êñ∞
                                                                                </button>
                                                                        </div>
                                                                </div>
                                                        </div>
                                                </div>

                                                {/* „Éá„Ç∞„Éº„ÅÆÁä∂ÊÖãË°®Á§∫„Çª„ÇØ„Ç∑„Éß„É≥ */}
                                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                                        <h2 className="text-xl font-bold mb-4 text-gray-800">üêπ „Éá„Ç∞„Éº„ÅÆÁèæÂú®„ÅÆÁä∂ÊÖãÔºàÈÅéÂéª5ÂàÜÈñì„ÅÆÊ¥ªÂãïÔºâ</h2>
                                                        <div className="flex flex-wrap gap-3 mb-3">
                                                                {deguStates.map((state, idx) => (
                                                                        <span key={idx} className={`px-4 py-2 rounded-full ${state.color} font-semibold text-lg`}>
                                                                                {state.label} {state.value}
                                                                        </span>
                                                                ))}
                                                        </div>
                                                        <div className="text-sm text-gray-500 mb-4">
                                                                Âà§ÂÆöÊúüÈñì: {previousData?.fullTime || '--'} ‚Üí {latestData?.fullTime || '--'}
                                                        </div>

                                                        {/* ÈÅéÂéª5ÂàÜÈñì„ÅÆÂ§âÂåñ„ÇíË°®Á§∫ */}
                                                        {sensorDiffs && (
                                                                <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                                                                        <p className="font-semibold mb-3 text-gray-800">ÈÅéÂéª5ÂàÜÈñì„ÅÆÂ§âÂåñ:</p>
                                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                                                                <div className="flex items-center gap-2">
                                                                                        <span className="text-xl">üèÉ</span>
                                                                                        <div>
                                                                                                <div className="text-xs text-gray-500">Ëµ∞Ë°åË∑ùÈõ¢</div>
                                                                                                <div className={`font-semibold ${sensorDiffs.rot > 0 ? 'text-purple-600' : 'text-gray-400'}`}>
                                                                                                        +{sensorDiffs.rot.toFixed(1)}m
                                                                                                </div>
                                                                                        </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2">
                                                                                        <span className="text-xl">üçΩÔ∏è</span>
                                                                                        <div>
                                                                                                <div className="text-xs text-gray-500">È£ü‰∫ã</div>
                                                                                                <div className={`font-semibold ${sensorDiffs.sit > 0 ? 'text-orange-600' : 'text-gray-400'}`}>
                                                                                                        +{sensorDiffs.sit.toFixed(1)}
                                                                                                </div>
                                                                                        </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2">
                                                                                        <span className="text-xl">üíß</span>
                                                                                        <div>
                                                                                                <div className="text-xs text-gray-500">È£≤Ê∞¥</div>
                                                                                                <div className={`font-semibold ${sensorDiffs.drk > 0 ? 'text-cyan-600' : 'text-gray-400'}`}>
                                                                                                        +{sensorDiffs.drk.toFixed(1)}ml
                                                                                                </div>
                                                                                        </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2">
                                                                                        <span className="text-xl">üêπ</span>
                                                                                        <div>
                                                                                                <div className="text-xs text-gray-500">Âãï‰Ωì</div>
                                                                                                <div className={`font-semibold ${sensorDiffs.mot > 0 ? 'text-green-600' : 'text-gray-400'}`}>
                                                                                                        +{sensorDiffs.mot}Âõû
                                                                                                </div>
                                                                                        </div>
                                                                                </div>
                                                                        </div>
                                                                </div>
                                                        )}
                                                </div>

                                                {/* ÊúÄÊñ∞ÂÄ§Ë°®Á§∫ - 6„Å§„ÅÆ„Éú„ÉÉ„ÇØ„Çπ */}
                                                {latestData && (
                                                        <div className="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">Ê∏©Â∫¶</div>
                                                                        <div className="text-3xl font-bold text-orange-600">{latestData.d3}¬∞C</div>
                                                                        <div className="text-xs text-gray-400 mt-1">THU-TEMP</div>
                                                                </div>
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">ÊπøÂ∫¶</div>
                                                                        <div className="text-3xl font-bold text-blue-600">{latestData.d4}%</div>
                                                                        <div className="text-xs text-gray-400 mt-1">THU-HUM</div>
                                                                </div>
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">Ëµ∞Ë°åË∑ùÈõ¢</div>
                                                                        <div className="text-3xl font-bold text-red-600">{latestData.d1}</div>
                                                                        <div className="text-xs text-gray-400 mt-1">ROT-ACUM</div>
                                                                </div>
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">È£≤Ê∞¥Á¥ØÁ©ç</div>
                                                                        <div className="text-3xl font-bold text-cyan-600">{latestData.d6}</div>
                                                                        <div className="text-xs text-gray-400 mt-1">DRK-ACUM</div>
                                                                </div>
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">MOT</div>
                                                                        <div className="text-3xl font-bold text-purple-600">{latestData.d7}</div>
                                                                        <div className="text-xs text-gray-400 mt-1">MOT-ACUM</div>
                                                                </div>
                                                                <div className="bg-white rounded-lg shadow p-4">
                                                                        <div className="text-sm text-gray-500 mb-1">SIT</div>
                                                                        <div className="text-3xl font-bold text-green-600">{latestData.d8}</div>
                                                                        <div className="text-xs text-gray-400 mt-1">KUSA-ACUM</div>
                                                                </div>
                                                        </div>
                                                )}

                                                {/* „Éá„Éº„Çø„Çµ„Éû„É™„Éº */}
                                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üå°Ô∏è Ê∏©ÊπøÂ∫¶Êé®Áßª</h2>
                                                                <div className="space-y-3">
                                                                        <DataRow label="ÁèæÂú®„ÅÆÊ∏©Â∫¶" value={`${latestData?.d3}¬∞C`} trend={calculateTrend(data, 'd3')} />
                                                                        <DataRow label="ÁèæÂú®„ÅÆÊπøÂ∫¶" value={`${latestData?.d4}%`} trend={calculateTrend(data, 'd4')} />
                                                                        <DataRow label="Âπ≥ÂùáÊ∏©Â∫¶" value={`${calculateAverage(data, 'd3')}¬∞C`} />
                                                                        <DataRow label="Âπ≥ÂùáÊπøÂ∫¶" value={`${calculateAverage(data, 'd4')}%`} />
                                                                </div>
                                                        </div>

                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üé° Ê¥ªÂãï„Çµ„Éû„É™„Éº</h2>
                                                                <div className="space-y-3">
                                                                        <DataRow label="ÂõûËª¢ÈÄüÂ∫¶" value={latestData?.d2} trend={calculateTrend(data, 'd2')} />
                                                                        <DataRow label="Ëµ∞Ë°åË∑ùÈõ¢" value={latestData?.d1} />
                                                                        <DataRow label="È£≤Ê∞¥Á¥ØÁ©ç" value={latestData?.d6} />
                                                                        <DataRow label="MOTÁ¥ØÁ©ç" value={latestData?.d7} />
                                                                        <DataRow label="SITÁ¥ØÁ©ç" value={latestData?.d8} />
                                                                </div>
                                                        </div>
                                                </div>

                                                {/* „Ç∞„É©„Éï„Ç®„É™„Ç¢ */}
                                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                                        {/* Ê∏©ÊπøÂ∫¶„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà Ê∏©Â∫¶„ÉªÊπøÂ∫¶„Ç∞„É©„Éï</h2>
                                                                <ChartComponent
                                                                        data={data}
                                                                        datasets={[
                                                                                { key: 'd3', label: 'Ê∏©Â∫¶ (¬∞C)', color: 'rgb(249, 115, 22)', yAxisID: 'y' },
                                                                                { key: 'd4', label: 'ÊπøÂ∫¶ (%)', color: 'rgb(59, 130, 246)', yAxisID: 'y1' }
                                                                        ]}
                                                                        dual={true}
                                                                />
                                                        </div>

                                                        {/* ROT„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà ÂõûËª¢Ê¥ªÂãï„Ç∞„É©„Éï</h2>
                                                                <ChartComponent
                                                                        data={data}
                                                                        datasets={[
                                                                                { key: 'd1', label: 'Ëµ∞Ë°åË∑ùÈõ¢', color: 'rgb(220, 38, 38)', yAxisID: 'y' },
                                                                                { key: 'd2', label: 'ÂõûËª¢ÈÄüÂ∫¶', color: 'rgb(79, 70, 229)', yAxisID: 'y1' }
                                                                        ]}
                                                                        dual={true}
                                                                />
                                                        </div>

                                                        {/* DRK„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà È£≤Ê∞¥Á¥ØÁ©ç„Ç∞„É©„Éï</h2>
                                                                <ChartComponent
                                                                        data={data}
                                                                        datasets={[
                                                                                { key: 'd6', label: 'È£≤Ê∞¥Á¥ØÁ©ç', color: 'rgb(6, 182, 212)', yAxisID: 'y' }
                                                                        ]}
                                                                        dual={false}
                                                                />
                                                        </div>

                                                        {/* MOT„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà MOT (Motion) „Ç∞„É©„Éï</h2>
                                                                <ChartComponent
                                                                        data={data}
                                                                        datasets={[
                                                                                { key: 'd7', label: 'MOT-ACUM', color: 'rgb(168, 85, 247)', yAxisID: 'y' }
                                                                        ]}
                                                                        dual={false}
                                                                />
                                                        </div>

                                                        {/* SIT„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà SIT (She is there) „Ç∞„É©„Éï</h2>
                                                                <ChartComponent
                                                                        data={data}
                                                                        datasets={[
                                                                                { key: 'd8', label: 'KUSA-ACUM', color: 'rgb(132, 204, 22)', yAxisID: 'y' }
                                                                        ]}
                                                                        dual={false}
                                                                />
                                                        </div>

                                                        {/* ‰ΩìÈáç„Ç∞„É©„Éï */}
                                                        <div className="bg-white rounded-lg shadow-lg p-6">
                                                                <h2 className="text-xl font-bold mb-4 text-gray-800">üìà ‰ΩìÈáçÊé®Áßª„Ç∞„É©„Éï</h2>
                                                                <HealthChartComponent healthRecords={healthRecords} />
                                                        </div>
                                                </div>

                                                {/* „Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´ */}
                                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                                        <h2 className="text-xl font-bold mb-4 text-gray-800">üìä ÊúÄÊñ∞„Éá„Éº„ÇøÔºà20‰ª∂Ôºâ</h2>
                                                        <div className="overflow-x-auto">
                                                                <table className="min-w-full divide-y divide-gray-200">
                                                                        <thead className="bg-gray-50">
                                                                                <tr>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊôÇÂàª</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ê∏©Â∫¶</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÊπøÂ∫¶</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ÂõûËª¢ÈÄüÂ∫¶</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ëµ∞Ë°åË∑ùÈõ¢</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">È£≤Ê∞¥</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">MOT</th>
                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">SIT</th>
                                                                                </tr>
                                                                        </thead>
                                                                        <tbody className="bg-white divide-y divide-gray-200">
                                                                                {data.slice(-20).reverse().map((row, idx) => (
                                                                                        <tr key={idx} className="hover:bg-gray-50">
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.time}</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm font-semibold text-orange-600">{row.d3}¬∞C</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm font-semibold text-blue-600">{row.d4}%</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.d2}</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.d1}</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.d5}</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.d7}</td>
                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{row.d8}</td>
                                                                                        </tr>
                                                                                ))}
                                                                        </tbody>
                                                                </table>
                                                        </div>
                                                </div>

                                                {/* ÂÅ•Â∫∑Ë®òÈå≤ÂÖ•Âäõ„Éï„Ç©„Éº„É† - „Éö„Éº„Ç∏ÊúÄ‰∏ãÈÉ®„Å´ÁßªÂãï */}
                                                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                                        <h2 className="text-xl font-bold mb-4 text-gray-800">üìù ÂÅ•Â∫∑Ë®òÈå≤„ÇíËøΩÂä†</h2>
                                                        <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
                                                                <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                                Êó•‰ªò
                                                                        </label>
                                                                        <input
                                                                                type="date"
                                                                                value={recordDate}
                                                                                onChange={(e) => setRecordDate(e.target.value)}
                                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                                                        />
                                                                </div>

                                                                <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                                ‰ΩìÈáç (g)
                                                                        </label>
                                                                        <input
                                                                                type="number"
                                                                                value={weight}
                                                                                onChange={(e) => setWeight(e.target.value)}
                                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                                                                placeholder="250"
                                                                        />
                                                                </div>

                                                                <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                                Á≥û„ÅÆÁä∂ÊÖã
                                                                        </label>
                                                                        <select
                                                                                value={fecesCondition}
                                                                                onChange={(e) => setFecesCondition(e.target.value)}
                                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                                                        >
                                                                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                                                <option value="normal">Ê≠£Â∏∏</option>
                                                                                <option value="soft">Ëªü‰æø</option>
                                                                                <option value="hard">Á°¨„ÅÑ</option>
                                                                                <option value="diarrhea">‰∏ãÁó¢</option>
                                                                        </select>
                                                                </div>

                                                                <div>
                                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                                                „É°„É¢
                                                                        </label>
                                                                        <input
                                                                                type="text"
                                                                                value={memo}
                                                                                onChange={(e) => setMemo(e.target.value)}
                                                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                                                                placeholder="Ê∞ó„Å•„ÅÑ„Åü„Åì„Å®„Å™„Å©"
                                                                        />
                                                                </div>

                                                                <div className="flex items-end">
                                                                        <button
                                                                                onClick={saveHealthRecord}
                                                                                className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                                                        >
                                                                                üíæ ‰øùÂ≠ò
                                                                        </button>
                                                                </div>
                                                        </div>

                                                        {/* ÂÅ•Â∫∑Ë®òÈå≤„ÉÜ„Éº„Éñ„É´ */}
                                                        {healthRecords.length > 0 && (
                                                                <div className="mt-6">
                                                                        <h3 className="text-lg font-bold mb-3 text-gray-800">üìä Ë®òÈå≤Â±•Ê≠¥ÔºàÊúÄÊñ∞10‰ª∂Ôºâ</h3>
                                                                        <div className="overflow-x-auto">
                                                                                <table className="min-w-full divide-y divide-gray-200">
                                                                                        <thead className="bg-gray-50">
                                                                                                <tr>
                                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Êó•‰ªò</th>
                                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">‰ΩìÈáç (g)</th>
                                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Á≥û„ÅÆÁä∂ÊÖã</th>
                                                                                                        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">„É°„É¢</th>
                                                                                                </tr>
                                                                                        </thead>
                                                                                        <tbody className="bg-white divide-y divide-gray-200">
                                                                                                {healthRecords.slice(-10).reverse().map((record, idx) => (
                                                                                                        <tr key={idx} className="hover:bg-gray-50">
                                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                                                                                                                        {new Date(record.date).toLocaleDateString('ja-JP')}
                                                                                                                </td>
                                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm font-semibold text-green-600">
                                                                                                                        {record.weight}g
                                                                                                                </td>
                                                                                                                <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                                                                                                                        {record.fecesCondition}
                                                                                                                </td>
                                                                                                                <td className="px-4 py-2 text-sm text-gray-900">
                                                                                                                        {record.memo}
                                                                                                                </td>
                                                                                                        </tr>
                                                                                                ))}
                                                                                        </tbody>
                                                                                </table>
                                                                        </div>
                                                                </div>
                                                        )}
                                                </div>

                                                <div className="text-center mt-8 pb-4">
                                                        <p className="text-sm text-gray-600">
                                                                üîÑ Ëá™ÂãïÊõ¥Êñ∞: 3ÂàÜÊØé | „Éá„Éº„Çø‰ª∂Êï∞: {data.length}‰ª∂ | ÂÅ•Â∫∑Ë®òÈå≤: {healthRecords.length}‰ª∂
                                                        </p>
                                                </div>
                                        </div>
                                </div>
                        );
                }

                // Chart.js„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
                function ChartComponent({ data, datasets, dual }) {
                        const chartRef = useRef(null);
                        const chartInstance = useRef(null);

                        useEffect(() => {
                                if (!chartRef.current || !data || data.length === 0) return;

                                if (chartInstance.current) {
                                        chartInstance.current.destroy();
                                }

                                const ctx = chartRef.current.getContext('2d');

                                const chartDatasets = datasets.map(ds => ({
                                        label: ds.label,
                                        data: data.map(item => item[ds.key]),
                                        borderColor: ds.color,
                                        backgroundColor: ds.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                                        tension: 0.4,
                                        yAxisID: ds.yAxisID
                                }));

                                const scales = {
                                        x: {
                                                display: true,
                                                ticks: {
                                                        maxRotation: 45,
                                                        minRotation: 45
                                                }
                                        },
                                        y: {
                                                type: 'linear',
                                                display: true,
                                                position: 'left'
                                        }
                                };

                                if (dual) {
                                        scales.y1 = {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                grid: {
                                                        drawOnChartArea: false
                                                }
                                        };
                                }

                                chartInstance.current = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                                labels: data.map(item => item.timeOnly),
                                                datasets: chartDatasets
                                        },
                                        options: {
                                                responsive: true,
                                                maintainAspectRatio: true,
                                                aspectRatio: 2,
                                                interaction: {
                                                        mode: 'index',
                                                        intersect: false
                                                },
                                                plugins: {
                                                        legend: {
                                                                display: true,
                                                                position: 'top'
                                                        },
                                                        tooltip: {
                                                                callbacks: {
                                                                        title: function (context) {
                                                                                return data[context[0].dataIndex].time;
                                                                        }
                                                                }
                                                        }
                                                },
                                                scales: scales
                                        }
                                });

                                return () => {
                                        if (chartInstance.current) {
                                                chartInstance.current.destroy();
                                        }
                                };
                        }, [data, datasets, dual]);

                        return <canvas ref={chartRef}></canvas>;
                }

                // ÂÅ•Â∫∑Ë®òÈå≤„Ç∞„É©„Éï„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
                function HealthChartComponent({ healthRecords }) {
                        const chartRef = useRef(null);
                        const chartInstance = useRef(null);

                        useEffect(() => {
                                if (!chartRef.current || !healthRecords || healthRecords.length === 0) return;

                                if (chartInstance.current) {
                                        chartInstance.current.destroy();
                                }

                                const ctx = chartRef.current.getContext('2d');

                                // Êó•‰ªò„Åß„ÇΩ„Éº„Éà
                                const sortedRecords = [...healthRecords].sort((a, b) =>
                                        new Date(a.date) - new Date(b.date)
                                );

                                chartInstance.current = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                                labels: sortedRecords.map(record =>
                                                        new Date(record.date).toLocaleDateString('ja-JP', { month: '2-digit', day: '2-digit' })
                                                ),
                                                datasets: [{
                                                        label: '‰ΩìÈáç (g)',
                                                        data: sortedRecords.map(record => record.weight),
                                                        borderColor: 'rgb(34, 197, 94)',
                                                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                                        tension: 0.4
                                                }]
                                        },
                                        options: {
                                                responsive: true,
                                                maintainAspectRatio: true,
                                                aspectRatio: 2,
                                                interaction: {
                                                        mode: 'index',
                                                        intersect: false
                                                },
                                                plugins: {
                                                        legend: {
                                                                display: true,
                                                                position: 'top'
                                                        },
                                                        tooltip: {
                                                                callbacks: {
                                                                        afterLabel: function (context) {
                                                                                const record = sortedRecords[context.dataIndex];
                                                                                return [
                                                                                        `Á≥û: ${record.fecesCondition}`,
                                                                                        record.memo ? `„É°„É¢: ${record.memo}` : ''
                                                                                ].filter(Boolean);
                                                                        }
                                                                }
                                                        }
                                                },
                                                scales: {
                                                        y: {
                                                                type: 'linear',
                                                                display: true,
                                                                position: 'left'
                                                        }
                                                }
                                        }
                                });

                                return () => {
                                        if (chartInstance.current) {
                                                chartInstance.current.destroy();
                                        }
                                };
                        }, [healthRecords]);

                        if (!healthRecords || healthRecords.length === 0) {
                                return (
                                        <div className="flex items-center justify-center h-48 text-gray-400">
                                                „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇË®òÈå≤„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                        </div>
                                );
                        }

                        return <canvas ref={chartRef}></canvas>;
                }

                function DataRow({ label, value, trend }) {
                        return (
                                <div className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                        <span className="text-sm font-medium text-gray-700">{label}</span>
                                        <div className="flex items-center gap-2">
                                                <span className="text-lg font-bold text-gray-900">{value}</span>
                                                {trend && (
                                                        <span className={`text-sm ${trend > 0 ? 'text-red-500' : 'text-blue-500'}`}>
                                                                {trend > 0 ? '‚Üë' : '‚Üì'}
                                                        </span>
                                                )}
                                        </div>
                                </div>
                        );
                }

                function calculateAverage(data, key) {
                        if (!data || data.length === 0) return '---';
                        const sum = data.reduce((acc, item) => acc + (parseFloat(item[key]) || 0), 0);
                        return (sum / data.length).toFixed(1);
                }

                function calculateTrend(data, key) {
                        if (!data || data.length < 10) return null;
                        const recent = data.slice(-5);
                        const previous = data.slice(-10, -5);
                        const recentAvg = recent.reduce((acc, item) => acc + (parseFloat(item[key]) || 0), 0) / 5;
                        const previousAvg = previous.reduce((acc, item) => acc + (parseFloat(item[key]) || 0), 0) / 5;
                        return recentAvg - previousAvg;
                }

                ReactDOM.render(<DeguMonitoringDashboard />, document.getElementById('root'));
        </script>
</body>

</html>